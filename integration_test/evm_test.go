package integration

import (
	"encoding/hex"
	"fmt"
	"github.com/kaifei-bianjie/msg-parser/codec"
	"github.com/kaifei-bianjie/msg-parser/utils"
)

func (s IntegrationTestSuite) TestEvm() {
	cases := []SubTest{
		{
			"MsgEthereumTx",
			MsgEthereumTx,
		},
	}

	for _, t := range cases {
		s.Run(t.testName, func() {
			t.testCase(s)
		})
	}
}
func MsgEthereumTx(s IntegrationTestSuite) {
	txBytes, err := hex.DecodeString("0abb040a87040a1f2f65746865726d696e742e65766d2e76312e4d7367457468657265756d547812e3030a93030a1a2f65746865726d696e742e65766d2e76312e4c6567616379547812f40208a716120d3130303030303030303030303018c08db701222a3078333534633661463263423837304245464541384561303238344337366534413436423846323837302a013032e401d0def52100000000000000000000000055a42bd8e6f9c6e58178b236e17f859dbe26f03d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000747b22616d6f756e74223a323032322c22756e69717565223a22736333386c6b346562613764766d62222c226e616d65223a22e78e8be88085e4b98be9a38ee7949fe88296e8998ee99990e9878fe78988222c22697373756572223a22e695b0e8978fe4b8ade59bbd222c22736571223a3839367d0000000000000000000000003a011c4220f2b389e23a1ba535994a818cceffc93e54ccc5c9cbcb975ed9edf08d275c55b24a206ad59d0f9edbabbbebc1d3d62a3d07cdaee3af21a672bb111a31cd9ac542a2be110000000000f074401a42307832663438623763313161663461383239613962656535356163353039616131356531373038373737623535613732616233366565663361613163613938306234fa3f2e0a2c2f65746865726d696e742e65766d2e76312e457874656e73696f6e4f7074696f6e73457468657265756d5478122612240a1d0a0675697269746112133330303030303030303030303030303030303010c08db701")
	if err != nil {
		fmt.Println(err.Error())
	}
	authTx, err := codec.GetSigningTx(txBytes)
	if err != nil {
		fmt.Println(err.Error())
	}
	for _, msg := range authTx.GetMsgs() {
		if bankDoc, ok := s.Evm.HandleTxMsg(msg); ok {
			fmt.Println(utils.MarshalJsonIgnoreErr(bankDoc))
		}
	}
}
